# ä½æ³¢åŠ¨ç‡ç­–ç•¥ä»£ç å®¡æŸ¥æŠ¥å‘Š

**å®¡æŸ¥æ—¥æœŸ**: 2026-02-09  
**ä»£ç ä½ç½®**: `/home/admin/.openclaw/workspace-dev/lowvol_strategy/`  
**å®¡æŸ¥äººå‘˜**: æ¶æ„å®¡æŸ¥å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v1.0.0

---

## 1. æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡å®¡æŸ¥å¯¹ä½æ³¢åŠ¨ç‡ç­–ç•¥ä»£ç è¿›è¡Œäº†å…¨é¢è¯„ä¼°ï¼Œæ•´ä½“ä»£ç ç»“æ„æ¸…æ™°ã€æ¨¡å—åˆ’åˆ†åˆç†ï¼ŒåŸºæœ¬ç¬¦åˆé‡åŒ–ç­–ç•¥å¼€å‘çš„æœ€ä½³å®è·µã€‚ä»£ç å…±åŒ…å« **6ä¸ªæ ¸å¿ƒæ¨¡å—**ï¼ˆå› å­è®¡ç®—ã€é€‰è‚¡å™¨ã€ä»“ä½ç®¡ç†ã€å›æµ‹å¼•æ“ã€ç»©æ•ˆåˆ†æã€é…ç½®ç®¡ç†ï¼‰ï¼Œ**15ä¸ªPythonæ–‡ä»¶**ã€‚

**æ€»ä½“è¯„ä»·**: â­â­â­â­ (4/5)

**ä¸»è¦ä¼˜åŠ¿**:
- æ¨¡å—åŒ–è®¾è®¡åˆç†ï¼Œå› å­è§£è€¦æ¸…æ™°
- é…ç½®åŒ–ç®¡ç†å‚æ•°ï¼Œä¾¿äºè°ƒä¼˜
- å›æµ‹æ¡†æ¶åŸºæœ¬å®Œæ•´

**å…³é”®é—®é¢˜**:
- âš ï¸ **ä¸¥é‡**: `self_test.py` æ–‡ä»¶è·¯å¾„å¼•ç”¨é”™è¯¯ï¼Œæ— æ³•æ­£å¸¸è¿è¡Œ
- âš ï¸ **ä¸­ç­‰**: å›æµ‹å¼•æ“å­˜åœ¨ä¸¤å¤„ç¡¬ç¼–ç å¯¼å…¥è·¯å¾„é—®é¢˜
- âš ï¸ **è½»å¾®**: éƒ¨åˆ†å› å­è®¡ç®—ç¼ºå°‘è¾“å…¥éªŒè¯å’Œå¼‚å¸¸å¤„ç†
- âš ï¸ **è½»å¾®**: ç¼ºå°‘å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–

---

## 2. ä»£ç è´¨é‡è¯„ä¼°

### 2.1 æ¶æ„è®¾è®¡ (è¯„åˆ†: 4.5/5)

```
lowvol_strategy/
â”œâ”€â”€ __init__.py              # âœ… ä¸»å…¥å£ï¼Œå¯¼å‡ºæ¸…æ™°
â”œâ”€â”€ config/
â”‚   â””â”€â”€ lowvol_config.py     # âœ… é…ç½®ç±»è®¾è®¡è‰¯å¥½
â”œâ”€â”€ factors/
â”‚   â”œâ”€â”€ volatility_factor.py  # âœ… æ³¢åŠ¨ç‡å› å­
â”‚   â”œâ”€â”€ atr_factor.py         # âœ… ATRå› å­
â”‚   â”œâ”€â”€ beta_factor.py        # âœ… Betaå› å­
â”‚   â”œâ”€â”€ quality_factor.py     # âœ… è´¨é‡å› å­
â”‚   â””â”€â”€ composite_score.py    # âœ… å¤åˆè¯„åˆ†
â”œâ”€â”€ selection/
â”‚   â””â”€â”€ stock_selector.py     # âœ… é€‰è‚¡å™¨
â”œâ”€â”€ position/
â”‚   â””â”€â”€ position_manager.py   # âœ… ä»“ä½ç®¡ç†
â”œâ”€â”€ backtest/
â”‚   â”œâ”€â”€ backtest_engine.py    # âœ… å›æµ‹å¼•æ“
â”‚   â””â”€â”€ performance.py        # âœ… ç»©æ•ˆåˆ†æ
â””â”€â”€ README.md                 # âœ… æ–‡æ¡£å®Œå–„
```

**ä¼˜ç‚¹**:
- æ¨¡å—èŒè´£æ¸…æ™°ï¼Œå› å­è®¡ç®—ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»
- é…ç½®ç±»ä½¿ç”¨ç±»å˜é‡ï¼Œä¾¿äºå¤–éƒ¨è®¿é—®å’Œä¿®æ”¹
- å¯¼å…¥è·¯å¾„ç®¡ç†è§„èŒƒï¼Œ`__all__` å¯¼å‡ºæ˜ç¡®

**æ”¹è¿›å»ºè®®**:
- å»ºè®®æ·»åŠ  `exceptions.py` è‡ªå®šä¹‰å¼‚å¸¸ç±»
- å»ºè®®æ·»åŠ  `constants.py` å¸¸é‡å®šä¹‰ï¼ˆå½“å‰åˆ†æ•£åœ¨é…ç½®ç±»ä¸­ï¼‰

### 2.2 ä»£ç è§„èŒƒ (è¯„åˆ†: 4/5)

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å‘½åè§„èŒƒ | âœ… | ç±»åå¤§é©¼å³°ï¼Œå‡½æ•°åå°é©¼å³° |
| æ–‡æ¡£å­—ç¬¦ä¸² | âœ… | æ‰€æœ‰å…¬å…±æ–¹æ³•å’Œç±»éƒ½æœ‰docstring |
| ç±»å‹æ³¨è§£ | âš ï¸ | éƒ¨åˆ†å‡½æ•°ç¼ºå°‘ç±»å‹æ³¨è§£ |
| å¼‚å¸¸å¤„ç† | âš ï¸ | å› å­è®¡ç®—ç¼ºå°‘è¾“å…¥éªŒè¯ |
| æ—¥å¿—è®°å½• | âš ï¸ | ç¼ºå°‘æ—¥å¿—è®°å½•å™¨é…ç½® |

---

## 3. å› å­è®¡ç®—å‡†ç¡®æ€§å®¡æŸ¥

### 3.1 æ³¢åŠ¨ç‡å› å­ (volatility_factor.py) âœ… é€šè¿‡

**è®¡ç®—å…¬å¼æ­£ç¡®æ€§**:
```python
# âœ… æ­£ç¡®ï¼šå¹´åŒ–æ³¢åŠ¨ç‡ = æ—¥æ ‡å‡†å·® Ã— âˆš250
annual_volatility = daily_std * np.sqrt(self.TRADING_DAYS_PER_YEAR)
```

**é—®é¢˜åˆ—è¡¨**:
1. âš ï¸ **è¾“å…¥åˆ¤æ–­é€»è¾‘å¯èƒ½å¤±æ•ˆ**:
   ```python
   # ç¬¬47-48è¡Œï¼šä»·æ ¼åˆ¤æ–­é˜ˆå€¼1å¯èƒ½ä¸å‡†ç¡®
   if prices.mean() > 1:  # å‡è®¾ä»·æ ¼åºåˆ—å‡å€¼å¤§äº1
   ```
   **é—®é¢˜**: å¯¹äºè‚¡ä»·æ¥è¿‘1å…ƒçš„è‚¡ç¥¨ï¼ˆå¦‚éƒ¨åˆ†æ¸¯è‚¡ã€æŒ‡æ•°åŸºé‡‘ï¼‰ï¼Œæ­¤åˆ¤æ–­ä¼šå¤±æ•ˆ
   
   **å»ºè®®**: 
   ```python
   # æ–¹æ¡ˆ1ï¼šæ˜¾å¼æŒ‡å®šè¾“å…¥ç±»å‹
   def calculate(self, prices, return_type='price'):
   
   # æ–¹æ¡ˆ2ï¼šä½¿ç”¨dtypeåˆ¤æ–­
   if pd.api.types.is_numeric_dtype(prices):
   ```

2. âš ï¸ **ç¼ºå°‘æ•°æ®éªŒè¯**:
   ```python
   if len(prices) < 2:
       return np.nan  # âœ… å·²æœ‰åŸºæœ¬æ£€æŸ¥
   ```
   **å»ºè®®**: æ·»åŠ NaN/Infå€¼æ£€æµ‹

### 3.2 ATRå› å­ (atr_factor.py) âœ… é€šè¿‡

**è®¡ç®—å…¬å¼æ­£ç¡®æ€§**:
```python
# âœ… æ­£ç¡®ï¼šTrueRange = max(High-Low, |High-PrevClose|, |Low-PrevClose|)
true_range = pd.concat([tr1, tr2, tr3], axis=1).max(axis=1)
```

**é—®é¢˜åˆ—è¡¨**:
1. âš ï¸ **ç¬¬ä¸€å¤©æ•°æ®å¤„ç†**:
   ```python
   prev_close = close.shift(1)  # âœ… æ­£ç¡®å¤„ç†
   ```
   **è¯´æ˜**: ç¬¬ä¸€å¤©ä¼šäº§ç”ŸNaNï¼Œç”±åç»­rollingå¤„ç†

### 3.3 Betaå› å­ (beta_factor.py) âœ… é€šè¿‡

**è®¡ç®—å…¬å¼æ­£ç¡®æ€§**:
```python
# âœ… æ­£ç¡®ï¼šBeta = Cov(Stock, Market) / Var(Market)
beta = rolling_cov / rolling_var
```

**é—®é¢˜åˆ—è¡¨**:
1. âš ï¸ **æ•°æ®å¯¹é½å¯èƒ½å‡ºé”™**:
   ```python
   # ç¬¬47-51è¡Œï¼šå¯¹é½é€»è¾‘æ­£ç¡®ï¼Œä½†åº”æ·»åŠ æ–­è¨€
   combined = pd.DataFrame({
       'stock': stock_returns,
       'benchmark': benchmark_returns
   }).dropna()
   ```
   **å»ºè®®**: æ·»åŠ é•¿åº¦åŒ¹é…æ£€æŸ¥

### 3.4 è´¨é‡å› å­ (quality_factor.py) âš ï¸ éœ€æ”¹è¿›

**é—®é¢˜åˆ—è¡¨**:
1. âš ï¸ **é™¤é›¶é£é™©**:
   ```python
   # ç¬¬28è¡Œï¼šmin()å¯èƒ½ä¸º0
   roe_normalized = (roe_series - roe_series.min()) / (roe_series.max() - roe_series.min() + 1e-8)
   ```
   **è¯´æ˜**: å·²æ·»åŠ  `+1e-8`ï¼Œâœ… è§„é¿äº†é™¤é›¶é£é™©

2. âš ï¸ **æ ‡å‡†åŒ–æ–¹æ³•è¿‡äºç®€å•**:
   ```python
   # ä½¿ç”¨Min-Maxæ ‡å‡†åŒ–ï¼Œå‡è®¾åˆ†å¸ƒå‡åŒ€
   # å¯¹äºROEç­‰é‡‘èæ•°æ®ï¼Œå¯èƒ½éœ€è¦æ›´ç¨³å¥çš„æ–¹æ³•ï¼ˆå¦‚ç™¾åˆ†ä½ï¼‰
   ```

### 3.5 å¤åˆè¯„åˆ† (composite_score.py) âš ï¸ éœ€æ”¹è¿›

**é—®é¢˜åˆ—è¡¨**:
1. âš ï¸ **æƒé‡éªŒè¯é€»è¾‘æ­£ç¡®ä½†ä¸¥æ ¼**:
   ```python
   # ç¬¬68-71è¡Œï¼šä¸¥æ ¼çš„æƒé‡éªŒè¯
   if abs(total_weight - 1.0) > 1e-6:
       raise ValueError(f"å› å­æƒé‡ä¹‹å’Œå¿…é¡»ä¸º1.0ï¼Œå½“å‰ä¸º{total_weight}")
   ```
   **å»ºè®®**: è€ƒè™‘æ·»åŠ è‡ªåŠ¨å½’ä¸€åŒ–é€‰é¡¹

2. âš ï¸ **Z-Scoreæ ‡å‡†åŒ–å¯èƒ½äº§ç”Ÿæç«¯å€¼**:
   ```python
   # ç¬¬86-91è¡Œï¼šstd=0æ—¶è¿”å›0ï¼Œä½†æœªå¤„ç†
   if std == 0 or pd.isna(std):
       return pd.Series(0, index=series.index)
   ```
   **è¯´æ˜**: å½“å‰å¤„ç†åˆç† âœ…

---

## 4. é€‰è‚¡é€»è¾‘åˆç†æ€§å®¡æŸ¥

### 4.1 é€‰è‚¡æµç¨‹ âœ… é€»è¾‘æ­£ç¡®

```
é€‰è‚¡æµç¨‹ï¼ˆstock_selector.pyï¼‰:
1. åŸºç¡€ç­›é€‰ï¼ˆä¸Šå¸‚å¤©æ•°ã€æˆäº¤é¢ï¼‰ âœ…
2. è´¢åŠ¡ç­›é€‰ï¼ˆROEã€èµ„äº§è´Ÿå€ºç‡ã€è‚¡æ¯ç‡ï¼‰ âœ…
3. ä½æ³¢ç­›é€‰ï¼ˆæ³¢åŠ¨ç‡ã€Betaã€ATR%ï¼‰ âœ…
4. å¤åˆè¯„åˆ†è®¡ç®— âœ…
5. Top Né€‰å– âœ…
```

### 4.2 å…³é”®é—®é¢˜

1. âš ï¸ **ATRç­›é€‰é˜ˆå€¼æœªä½¿ç”¨é…ç½®å€¼**:
   ```python
   # ç¬¬136-139è¡Œï¼šATRä¸Šé™é˜ˆå€¼ç¡¬ç¼–ç 
   if atr_percent_upper_limit:
       atr_percent_upper_limit = stock_data[atr_percent_col].median()
       atr_filter = stock_data[atr_percent_col] <= atr_percent_upper_limit
   ```
   **é—®é¢˜**: `filter_lowvol` æ–¹æ³•ä¸­ `atr_percent_upper_limit` å‚æ•°é»˜è®¤å€¼æ˜¯ `None`ï¼Œå¯¼è‡´å§‹ç»ˆä½¿ç”¨åŠ¨æ€ä¸­ä½æ•°è€Œéé…ç½®å€¼
   
   **å»ºè®®**: 
   ```python
   # æ·»åŠ é…ç½®å±æ€§
   ATR_PERCENT_UPPER_LIMIT = 5.0  # é»˜è®¤5%
   
   def filter_lowvol(...):
       if atr_percent_upper_limit is None:
           atr_percent_upper_limit = self.config.ATR_PERCENT_UPPER_LIMIT
   ```

2. âš ï¸ **ç©ºæ•°æ®å¤„ç†**:
   ```python
   # ç¬¬159-162è¡Œï¼šç©ºæ•°æ®æ—¶è¿”å›å…¨False
   if len(df_scored) == 0:
       final_selection = pd.Series(False, index=df.index)
   ```
   **å»ºè®®**: æ·»åŠ è­¦å‘Šæ—¥å¿—

---

## 5. å›æµ‹å¼•æ“å®¡æŸ¥

### 5.1 æ¶æ„ âœ… åŸºæœ¬å®Œæ•´

### 5.2 ä¸¥é‡é—®é¢˜

1. ğŸ”´ **å¯¼å…¥è·¯å¾„é”™è¯¯**:
   ```python
   # backtest_engine.py ç¬¬18è¡Œ
   from selection import LowVolStockSelector
   ```
   **é—®é¢˜**: åº”è¯¥æ˜¯ç›¸å¯¹å¯¼å…¥ `from ..selection import LowVolStockSelector`
   
   ```python
   # backtest_engine.py ç¬¬19è¡Œ
   from position import PositionManager
   ```
   **é—®é¢˜**: åº”è¯¥æ˜¯ç›¸å¯¹å¯¼å…¥ `from ..position import PositionManager`

   **å½±å“**: å›æµ‹å¼•æ“æ— æ³•ç‹¬ç«‹è¿è¡Œï¼Œä¼šæŠ¥ `ImportError`

2. âš ï¸ **å›æµ‹æœŸé—´æ—¥æœŸå¤„ç†ä¸ä¸€è‡´**:
   ```python
   # ç¬¬113-117è¡Œï¼šä¼ å…¥datetimeå¯¹è±¡
   def run(self, start_date: datetime = None, end_date: datetime = None):
   
   # ä½†åœ¨__init__.pyä¸­ä¼ å…¥å­—ç¬¦ä¸²
   start = pd.to_datetime(start_date) if start_date else None
   ```
   **å»ºè®®**: ç»Ÿä¸€å¤„ç†é€»è¾‘

3. âš ï¸ **äº¤æ˜“æˆæœ¬è®¡ç®—å¯èƒ½åé«˜**:
   ```python
   # ç¬¬165è¡Œï¼šå–å‡ºæ—¶æ”¶å–äº¤æ˜“æˆæœ¬
   sell_value = shares * sell_price * (1 - self.transaction_cost)
   ```
   **é—®é¢˜**: Aè‚¡å–å‡ºæ—¶é€šå¸¸ä¸æ”¶å–å°èŠ±ç¨ï¼ˆä»…ä¹°å…¥æ”¶å–ä½£é‡‘ï¼‰ï¼Œæ­¤å®ç°å¯èƒ½é«˜ä¼°æˆæœ¬
   
   **å»ºè®®**: åŒºåˆ†ä¹°å…¥å’Œå–å‡ºæˆæœ¬

### 5.3 ä»“ä½ç®¡ç† âœ… åˆç†

- ç­‰æƒé…ç½®é€»è¾‘æ­£ç¡®
- è¡Œä¸šæƒé‡æ§åˆ¶ç®—æ³•åˆç†
- æ­¢æŸé€»è¾‘åŸºæœ¬å®Œæ•´

---

## 6. æµ‹è¯•è¦†ç›–å®¡æŸ¥

### 6.1 ä¸¥é‡é—®é¢˜

1. ğŸ”´ **self_test.py æ–‡ä»¶è·¯å¾„é”™è¯¯**:
   ```
   /home/admin/.openclaw/workspace-dev/lowvol_strategy/self_test.py
   ```
   
   è¯¥æ–‡ä»¶å¼•ç”¨äº†:
   ```python
   from tests import SelfTest
   ```
   
   **é—®é¢˜**: `tests` ç›®å½•å­˜åœ¨ä½† `self_test.py` åœ¨æ ¹ç›®å½•ï¼Œå¯¼è‡´ï¼š
   - è¿è¡Œæ—¶æ‰¾ä¸åˆ° `SelfTest` ç±»
   - æ¨¡å—å¾ªç¯å¼•ç”¨é—®é¢˜

### 6.2 å»ºè®®æ·»åŠ çš„æµ‹è¯•

| æµ‹è¯•ç±»å‹ | è¦†ç›–æƒ…å†µ | å»ºè®® |
|----------|----------|------|
| å•å…ƒæµ‹è¯• | âŒ æ—  | æ·»åŠ  pytest æµ‹è¯•ç”¨ä¾‹ |
| å› å­è®¡ç®—éªŒè¯ | âš ï¸ éƒ¨åˆ† | æ·»åŠ æ•°å€¼ç²¾åº¦éªŒè¯ |
| è¾¹ç•Œæ¡ä»¶æµ‹è¯• | âŒ æ—  | æ·»åŠ ç©ºæ•°æ®ã€å¼‚å¸¸æ•°æ®æµ‹è¯• |
| é›†æˆæµ‹è¯• | âš ï¸ éƒ¨åˆ† | æ·»åŠ å®Œæ•´å›æµ‹æµç¨‹æµ‹è¯• |

---

## 7. æ½œåœ¨é—®é¢˜æ±‡æ€»

### 7.1 ä¸¥é‡é—®é¢˜ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

| ID | æ¨¡å— | é—®é¢˜æè¿° | å½±å“ |
|----|------|----------|------|
| P01 | self_test.py | æ–‡ä»¶è·¯å¾„å¼•ç”¨é”™è¯¯ï¼Œæµ‹è¯•æ— æ³•è¿è¡Œ | è´¨é‡ä¿è¯å¤±æ•ˆ |
| P02 | backtest_engine.py | å¯¼å…¥è·¯å¾„é”™è¯¯ï¼ˆç»å¯¹è·¯å¾„ï¼‰ | æ¨¡å—æ— æ³•ç‹¬ç«‹è¿è¡Œ |

### 7.2 ä¸­ç­‰é—®é¢˜ï¼ˆå»ºè®®ä¿®å¤ï¼‰

| ID | æ¨¡å— | é—®é¢˜æè¿° | å½±å“ |
|----|------|----------|------|
| P03 | volatility_factor.py | è¾“å…¥ç±»å‹åˆ¤æ–­é˜ˆå€¼å¯èƒ½å¤±æ•ˆ | ä½ä»·è‚¡è®¡ç®—é”™è¯¯ |
| P04 | stock_selector.py | ATRç­›é€‰æœªä½¿ç”¨é…ç½®å€¼ | å‚æ•°ä¸ä¸€è‡´ |
| P05 | backtest_engine.py | äº¤æ˜“æˆæœ¬æ¨¡å‹ä¸å‡†ç¡® | å›æµ‹ç»“æœåé«˜ |
| P06 | é€šç”¨ | ç¼ºå°‘ç±»å‹æ³¨è§£ | IDEæ”¯æŒä¸è¶³ |
| P07 | é€šç”¨ | ç¼ºå°‘æ—¥å¿—è®°å½• | è°ƒè¯•å›°éš¾ |

### 7.3 è½»å¾®é—®é¢˜ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

| ID | æ¨¡å— | é—®é¢˜æè¿° |
|----|------|----------|
| P08 | é€šç”¨ | å¯æ·»åŠ è‡ªå®šä¹‰å¼‚å¸¸ç±» |
| P09 | quality_factor.py | æ ‡å‡†åŒ–æ–¹æ³•å¯ä¼˜åŒ– |
| P10 | é€šç”¨ | å¯æ·»åŠ é…ç½®æ–‡ä»¶schemaéªŒè¯ |

---

## 8. æ”¹è¿›å»ºè®®

### 8.1 ç«‹å³ä¿®å¤ï¼ˆé˜»æ–­æ€§é—®é¢˜ï¼‰

```python
# 1. ä¿®å¤ self_test.py å’Œå¯¼å…¥è·¯å¾„

# self_test.py åº”è¯¥æ˜¯:
#!/usr/bin/env python3
"""
ä½æ³¢åŠ¨ç‡ç­–ç•¥ - è‡ªæµ‹éªŒè¯è„šæœ¬
"""

import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from lowvol_strategy import LowVolStrategy, LowVolConfig

def main():
    """ä¸»å‡½æ•°"""
    # æµ‹è¯•é…ç½®
    config = LowVolConfig()
    
    # åˆå§‹åŒ–ç­–ç•¥
    strategy = LowVolStrategy(config)
    
    print("âœ“ ç­–ç•¥åˆå§‹åŒ–æˆåŠŸ")
    print(f"âœ“ æ³¢åŠ¨ç‡æƒé‡: {config.VOLATILITY_WEIGHT}")
    print(f"âœ“ ATRæƒé‡: {config.ATR_WEIGHT}")
    print(f"âœ“ Betaæƒé‡: {config.BETA_WEIGHT}")
    print(f"âœ“ è´¨é‡å› å­æƒé‡: {config.QUALITY_WEIGHT}")
    
    return 0

if __name__ == "__main__":
    sys.exit(main())

# 2. ä¿®å¤ backtest_engine.py å¯¼å…¥è·¯å¾„
# åº”è¯¥æ˜¯:
from ..selection import LowVolStockSelector
from ..position import PositionManager
```

### 8.2 çŸ­æœŸä¼˜åŒ–

```python
# 1. æ·»åŠ å› å­è¾“å…¥éªŒè¯
def calculate(self, prices: Union[pd.Series, np.ndarray]) -> float:
    """è®¡ç®—å¹´åŒ–æ³¢åŠ¨ç‡"""
    # éªŒè¯è¾“å…¥
    if prices is None or len(prices) < 2:
        return np.nan
    
    # è½¬æ¢ä¸ºpandas Series
    if isinstance(prices, np.ndarray):
        prices = pd.Series(prices)
    
    # å»é™¤NaN
    prices = prices.dropna()
    
    if len(prices) < 2:
        return np.nan
    
    # ... ç»§ç»­è®¡ç®—

# 2. æ·»åŠ ATRé…ç½®å‚æ•°
# åœ¨ LowVolConfig ä¸­æ·»åŠ :
ATR_PERCENT_UPPER_LIMIT = 5.0  # ATRç™¾åˆ†æ¯”ä¸Šé™ï¼ˆ%ï¼‰

# åœ¨ stock_selector.py ä¸­ä½¿ç”¨:
def filter_lowvol(...):
    if atr_percent_upper_limit is None:
        atr_percent_upper_limit = self.config.ATR_PERCENT_UPPER_LIMIT
```

### 8.3 é•¿æœŸå»ºè®®

1. **æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•æ¡†æ¶**
2. **æ·»åŠ ç±»å‹æ³¨è§£ï¼ˆPEP 484ï¼‰**
3. **æ·»åŠ æ—¥å¿—é…ç½®æ¨¡å—**
4. **æ·»åŠ CI/CDè‡ªåŠ¨åŒ–æµ‹è¯•**
5. **è€ƒè™‘æ·»åŠ å› å­ç›¸å…³æ€§åˆ†æ**

---

## 9. ç»“è®º

ä½æ³¢åŠ¨ç‡ç­–ç•¥ä»£ç æ•´ä½“è´¨é‡è‰¯å¥½ï¼Œæ¶æ„è®¾è®¡åˆç†ï¼Œé€‚åˆä½œä¸ºç”Ÿäº§çº§ç­–ç•¥çš„åŸºç¡€ã€‚**ä½†åœ¨æŠ•å…¥å®é™…ä½¿ç”¨å‰ï¼Œå¿…é¡»ä¿®å¤ä»¥ä¸‹é˜»æ–­æ€§é—®é¢˜**ï¼š

1. âœ… ä¿®å¤ `self_test.py` æ–‡ä»¶è·¯å¾„å’Œå¯¼å…¥é—®é¢˜
2. âœ… ä¿®å¤ `backtest_engine.py` çš„ç›¸å¯¹å¯¼å…¥è·¯å¾„

**é£é™©è¯„ä¼°**:
- ğŸ”´ **ç”Ÿäº§é£é™©**: ä¸­ç­‰ï¼ˆéœ€ä¿®å¤é˜»æ–­æ€§é—®é¢˜ï¼‰
- ğŸ“Š **å›æµ‹å‡†ç¡®æ€§**: åŸºæœ¬å‡†ç¡®ï¼ˆéœ€ä¼˜åŒ–æˆæœ¬æ¨¡å‹ï¼‰
- ğŸ”§ **å¯ç»´æŠ¤æ€§**: è‰¯å¥½ï¼ˆæ¨¡å—åŒ–è®¾è®¡æ¸…æ™°ï¼‰
- ğŸ“ˆ **æ‰©å±•æ€§**: è‰¯å¥½ï¼ˆé…ç½®åŒ–ç®¡ç†ï¼‰

---

## 10. é™„å½•

### A. å®¡æŸ¥æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¡Œæ•° | çŠ¶æ€ |
|------|------|------|
| __init__.py | 100+ | âœ… é€šè¿‡ |
| config/lowvol_config.py | 150+ | âœ… é€šè¿‡ |
| factors/volatility_factor.py | 150+ | âœ… é€šè¿‡ |
| factors/atr_factor.py | 150+ | âœ… é€šè¿‡ |
| factors/beta_factor.py | 180+ | âœ… é€šè¿‡ |
| factors/quality_factor.py | 120+ | âš ï¸ è½»å¾®é—®é¢˜ |
| factors/composite_score.py | 170+ | âš ï¸ è½»å¾®é—®é¢˜ |
| selection/stock_selector.py | 190+ | âš ï¸ ä¸­ç­‰é—®é¢˜ |
| position/position_manager.py | 170+ | âœ… é€šè¿‡ |
| backtest/backtest_engine.py | 250+ | ğŸ”´ éœ€ä¿®å¤ |
| backtest/performance.py | 220+ | âœ… é€šè¿‡ |
| README.md | 350+ | âœ… é€šè¿‡ |

### B. å‚è€ƒèµ„æ–™

- äº§å“è®¾è®¡æ–‡æ¡£: `/home/admin/.openclaw/workspace-product/MOMENTUM_LOWVOL_PRODUCT_DESIGN.md`
- åŠ¨é‡ç­–ç•¥ä»£ç å®¡æŸ¥æŠ¥å‘Š: `/home/admin/.openclaw/workspace-architect/momentum_strategy_review.md`

---

**å®¡æŸ¥å®Œæˆæ—¶é—´**: 2026-02-09  
**ä¸‹æ¬¡å»ºè®®å®¡æŸ¥**: ä¿®å¤é˜»æ–­æ€§é—®é¢˜å
