# 牛市高倍策略代码审查准备文档

**创建时间**: 2026-02-09 14:12 GMT+8  
**审查目标**: dev-engineer 开发的牛市高倍策略代码  
**文档路径**: `/home/admin/.openclaw/workspace-architect/bull_strategy/`  

---

## 1. 产品背景

### 1.1 策略定位
- **策略类型**: 动量策略 (Momentum Strategy) 变体
- **市场环境**: 牛市行情
- **收益目标**: 高倍数收益 (>3x)
- **风险等级**: 高风险

### 1.2 现有代码架构参考
```
scripts/strategies/
├── base/                      # 公共基类 ✅
│   ├── base_selector.py       # 选股器基类
│   ├── base_backtest.py       # 回测框架基类
│   └── base_tuner.py          # 调参基类
│
├── quality/                   # 质量策略 ✅
│   ├── quality_selector.py    # 选股器
│   ├── quality_backtest.py    # 回测框架
│   └── tune_quality.py        # 调参脚本
│
├── value/                     # 价值策略 ✅
│   ├── value_selector.py      # 选股器
│   ├── value_backtest.py      # 回测框架
│   └── tune_value.py          # 调参脚本
│
├── momentum/                  # 动量策略 ✅
│   ├── momentum_selector.py   # 选股器
│   ├── momentum_backtest.py   # 回测框架
│   └── tune_momentum.py       # 调参脚本
│
└── reports/                   # 报告工具 ✅
    └── report_generator.py    # 报告生成器
```

### 1.3 预期新增模块
```
scripts/strategies/bull/          # 牛市高倍策略 (待开发)
├── __init__.py
├── bull_selector.py              # 选股器
├── bull_backtest.py              # 回测框架
├── bull_config.py                # 策略配置
└── tune_bull.py                  # 调参脚本
```

---

## 2. 代码审查清单

### 2.1 功能完整性 ✅

| 检查项 | 描述 | 状态 |
|--------|------|------|
| 选股器 | 实现牛市筛选逻辑（放量、突破新高、强势板块） | ⬜ |
| 回测框架 | 支持高杠杆参数、回撤控制、止盈止损 | ⬜ |
| 调参脚本 | 支持参数网格搜索、优化夏普比率 | ⬜ |
| 配置模块 | 易用的策略参数配置接口 | ⬜ |
| 报告生成 | 可视化收益曲线、风险指标 | ⬜ |

### 2.2 代码质量 ✅

| 检查项 | 描述 | 标准 |
|--------|------|------|
| 命名规范 | 类名 PascalCase，函数名 snake_case | PEP 8 |
| 类型注解 | 函数参数和返回值应有类型提示 | 必需 |
| 文档字符串 | 每个公开类/函数需 docstring | Google Style |
| 代码复杂度 | 函数不超过 50 行，圈复杂度 < 10 | 建议 |
| 重复代码 | 超过 3 处重复应抽取公共函数 | 建议 |

### 2.3 架构一致性 ✅

| 检查项 | 描述 | 状态 |
|--------|------|------|
| 继承关系 | 继承 `base/` 模块的基类 | ⬜ |
| 接口一致 | 与 `momentum/` 模块接口保持一致 | ⬜ |
| 配置格式 | 使用 YAML/JSON 配置文件 | ⬜ |
| 日志规范 | 使用统一日志模块 | ⬜ |

### 2.4 性能要求 ✅

| 检查项 | 描述 | 标准 |
|--------|------|------|
| 数据加载 | 支持增量加载，避免重复计算 | ⬜ |
| 回测速度 | 单次回测 < 5 秒（10年数据） | ⬜ |
| 内存占用 | 单次运行 < 1GB RAM | ⬜ |
| 并发支持 | 支持多进程回测 | 建议 |

### 2.5 安全性 ✅

| 检查项 | 描述 | 标准 |
|--------|------|------|
| 输入验证 | 外部参数需校验范围和类型 | 必需 |
| 异常处理 | 所有外部调用需 try-except | 必需 |
| 资金安全 | 回测禁止实盘连接，需模拟账户 | 必需 |
| 依赖安全 | 无已知 CVE 漏洞依赖 | ⬜ |

---

## 3. 审查标准与最佳实践

### 3.1 代码风格标准

```python
# ✅ 正确的命名示例
class BullStrategySelector(BaseSelector):
    """牛市高倍策略选股器"""

    def __init__(self, config: BullConfig) -> None:
        self.config = config

    def select(self, market_data: pd.DataFrame) -> List[str]:
        """选择符合条件的股票"""
        pass
```

```python
# ❌ 错误的命名示例
class bull_sel:  # 类名应 PascalCase
    def __init__(self, c):  # 缺少类型注解
        self.c = c

    def sel(self, d):  # 缺少文档字符串
        pass
```

### 3.2 错误处理规范

```python
# ✅ 正确的错误处理
try:
    result = self._fetch_market_data(symbol, start_date, end_date)
except DataSourceError as e:
    logger.error(f"获取数据失败: {e}")
    raise StrategyError(f"数据源异常: {e}") from e
except Exception as e:
    logger.exception(f"未知错误: {e}")
    raise
```

```python
# ❌ 错误的错误处理
try:
    result = data.fetch()
except:
    pass  # 静默失败
```

### 3.3 测试要求

| 测试类型 | 覆盖范围 | 通过标准 |
|----------|----------|----------|
| 单元测试 | 核心函数 > 80% | ✅ |
| 集成测试 | 选股+回测流程 | ✅ |
| 边界测试 | 空数据、极端值 | ✅ |
| 性能测试 | 回测速度 < 5s | 建议 |

### 3.4 文档要求

| 文档类型 | 必需 | 内容 |
|----------|------|------|
| README.md | ✅ | 安装说明、使用示例 |
| CONFIG.md | ✅ | 参数说明、默认值 |
| API 文档 | ✅ | 公开接口说明 |
| CHANGELOG | ✅ | 版本变更记录 |

---

## 4. 关键审查点

### 4.1 选股逻辑重点审查

1. **牛市特征识别**
   - [ ] 放量突破逻辑
   - [ ] 强势板块轮动
   - [ ] 均线多头排列

2. **风险过滤**
   - [ ] 流动性过滤（日均成交 > 1000万）
   - [ ] 波动率过滤（排除异动股）
   - [ ] 基本面过滤（PE、营收增长）

3. **高倍因子**
   - [ ] 动量强度计算
   - [ ] 相对强度排名
   - [ ] 仓位管理逻辑

### 4.2 回测框架重点审查

1. **资金管理**
   - [ ] 杠杆倍数配置
   - [ ] 仓位计算公式
   - [ ] 资金曲线回撤控制

2. **交易成本**
   - [ ] 滑点模拟
   - [ ] 手续费计算
   - [ ] 印花税考虑

3. **绩效指标**
   - [ ] 年化收益率
   - [ ] 最大回撤
   - [ ] 夏普比率
   - [ ] 胜率/盈亏比

### 4.3 配置模块重点审查

1. **可配置参数**
   - [ ] 选股参数（周期、阈值）
   - [ ] 仓位参数（杠杆、分散度）
   - [ ] 止损参数（固定/ATR）
   - [ ] 止盈参数（移动/固定）

2. **配置验证**
   - [ ] 参数范围检查
   - [ ] 互斥参数检测
   - [ ] 默认值合理性

---

## 5. 审查流程

### 5.1 提交检查清单

dev-engineer 提交代码时需确认：

- [ ] 代码已完成并通过自测
- [ ] 所有单测通过 (`pytest`)
- [ ] 无 lint 警告 (`pylint` / `ruff`)
- [ ] 文档已更新
- [ ] 配置示例已添加

### 5.2 审查步骤

```
1. 📋 检查清单确认
   └── 确认提交检查表完成

2. 📁 代码结构审查
   └── 文件结构、模块划分

3. 🔍 代码逻辑审查
   └── 核心算法、计算逻辑

4. 🧪 测试覆盖审查
   └── 测试用例、覆盖率

5. 📊 性能评估
   └── 回测速度、内存占用

6. 📝 文档完整性
   └── README、API 文档

7. ✅ 最终确认
   └── 通过/修改/拒绝
```

### 5.3 审查时间预估

| 阶段 | 预估时间 |
|------|----------|
| 代码结构 | 10 分钟 |
| 核心逻辑 | 30 分钟 |
| 测试验证 | 15 分钟 |
| 性能测试 | 10 分钟 |
| 文档检查 | 5 分钟 |
| **总计** | **~70 分钟** |

---

## 6. 输出模板

### 6.1 审查结果模板

```markdown
## 牛市高倍策略代码审查结果

**审查日期**: YYYY-MM-DD  
**审查人**: Architect  
**代码版本**: [commit hash]

### 总体评价
[通过 / 有条件通过 / 拒绝]

### 评分
- 功能完整性: X/5
- 代码质量: X/5
- 架构一致性: X/5
- 性能: X/5
- 安全性: X/5

### 问题清单
| 严重性 | 问题描述 | 位置 | 建议修复 |
|--------|----------|------|----------|
| 🔴 高 | 问题1 | 文件:行号 | 修复建议 |
| 🟡 中 | 问题2 | 文件:行号 | 修复建议 |
| 🟢 低 | 问题3 | 文件:行号 | 修复建议 |

### 改进建议
1. ...
2. ...

### 复审要求
- [ ] 问题1 已修复
- [ ] 问题2 已修复
```

---

## 7. 快速参考

### 7.1 相关文件路径

| 路径 | 描述 |
|------|------|
| `/home/admin/.openclaw/workspace/commodity-monitor/scripts/strategies/` | 策略模块根目录 |
| `/home/admin/.openclaw/workspace/commodity-monitor/scripts/strategies/base/` | 公共基类 |
| `/home/admin/.openclaw/workspace/commodity-monitor/scripts/strategies/momentum/` | 动量策略参考 |
| `/home/admin/.openclaw/workspace-architect/bull_strategy/` | 本审查目录 |

### 7.2 联系方式

| 角色 | 职责 |
|------|------|
| dev-engineer | 代码开发 |
| Architect | 代码审查 |
| qa-tester | 测试验证 |

---

## 8. 待办清单

- [ ] 等待 dev-engineer 提交代码
- [ ] 确认 BULL_STRATEGY.md 产品文档（若存在）
- [ ] 执行代码审查
- [ ] 输出审查报告
- [ ] 如有修改，进行复审

---

**文档版本**: 1.0  
**最后更新**: 2026-02-09 14:12 GMT+8
