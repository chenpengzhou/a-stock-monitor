# ä»£ç å®¡æŸ¥æŠ¥å‘Š

**å®¡æŸ¥æ—¥æœŸ**: 2026-02-09
**å®¡æŸ¥äºº**: Architect
**å®¡æŸ¥èŒƒå›´**: OpenClaw é¡¹ç›®æ ¸å¿ƒæ¨¡å—

---

## ðŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡ä»£ç å®¡æŸ¥è¦†ç›–äº†é¡¹ç›®çš„æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…æ‹¬ï¼š
- åŠ å¯†è´§å¸ç›‘æŽ§æ¨¡å— (`crypto-monitor`)
- å¤§å®—å•†å“é€‰è‚¡æ¨¡å— (`commodity-monitor`)
- API ä¸­è½¬æœåŠ¡ (`crypto-api-proxy.js`)
- é€šçŸ¥ç³»ç»Ÿ (`telegram_notifier.py`)

**æ€»ä½“è¯„ä¼°**: âš ï¸ **ä¸­ç­‰é£Žé™©** - ä»£ç åŠŸèƒ½å®Œæ•´ï¼Œä½†å­˜åœ¨å¤šé¡¹éœ€è¦æ”¹è¿›çš„æŠ€æœ¯å€ºåŠ¡ã€‚

---

## ðŸ”´ ä¸¥é‡é—®é¢˜

### 1. å®‰å…¨æ¼æ´žï¼šç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
**ä½ç½®**: `crypto-monitor/config/api_config.yaml`
```yaml
whale_addresses:
  - name: "Justin Sun"
    address: "0x3ddfa8ec3052539b6c9549f12cea2c295cff5296"  # âš ï¸ è¿™æ˜¯ä¸€ä¸ªçœŸå®žåœ°å€
  - name: "Binance Cold Wallet"
    address: "0xf68c9df95a18b2a5a31fa9c7f8a3a0a8c3d0f7e8"  # âš ï¸ åœ°å€æ ¼å¼å¯ç–‘
```
**é£Žé™©**: ä½¿ç”¨çœŸå®žåäºº/äº¤æ˜“æ‰€åœ°å€ä½œä¸ºé…ç½®ç¤ºä¾‹ï¼Œå¯èƒ½å¯¼è‡´è¯¯ç”¨å’ŒAPIæ»¥ç”¨ã€‚
**å»ºè®®**: ä½¿ç”¨å ä½ç¬¦æˆ–ç¤ºä¾‹åœ°å€ï¼Œæ˜Žç¡®æ ‡æ³¨ç¦æ­¢ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒã€‚

### 2. æ•°æ®ä¼ªé€ é—®é¢˜
**ä½ç½®**: `crypto-monitor/scripts/monitor_base.py`
```python
def _get_estimated_liquidation(self, symbol: str) -> Dict[str, Any]:
    # åŠ å…¥éšæœºå› å­ï¼ˆÂ±20%ï¼‰ä½¿æ•°æ®æ›´çœŸå®ž
    random_factor = 0.8 + random.random() * 0.4
```
**é£Žé™©**: ä¼°ç®—æ•°æ®å¸¦æœ‰éšæœºæ€§ï¼Œå¯èƒ½è¢«è¯¯è®¤ä¸ºæ˜¯çœŸå®žæ•°æ®ã€‚
**å»ºè®®**: 
- æ·»åŠ æ˜Žç¡®çš„æ•°æ®æ¥æºæ ‡è¯†
- åŒºåˆ†çœŸå®žæ•°æ®å’Œä¼°ç®—æ•°æ®
- è€ƒè™‘ä½¿ç”¨ç¡®å®šæ€§éšæœºç§å­

### 3. API Key é…ç½®ä¸ºç©º
**ä½ç½®**: `crypto-monitor/config/api_config.yaml`
```yaml
blockchain:
  etherscan:
    api_key: ""  # å…¬å…±APIæœ‰é™åˆ¶
  bscscan:
    api_key: ""  # åŒæ ·é—®é¢˜
```
**é£Žé™©**: ç”Ÿäº§çŽ¯å¢ƒè¿è¡Œå¯èƒ½è§¦å‘APIé™æµã€‚
**å»ºè®®**: æ·»åŠ é…ç½®éªŒè¯ï¼Œç¡®ä¿å…³é”®API Keyåœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­å·²é…ç½®ã€‚

---

## ðŸŸ  ä¸­ç­‰é—®é¢˜

### 4. ä»£ç é‡å¤ï¼šåŒæ­¥/å¼‚æ­¥æ··ç”¨
**ä½ç½®**: `crypto-monitor/scripts/monitor_base.py`
```python
async def get_okx_price(self, symbol: str) -> Optional[float]:
    async with aiohttp.ClientSession() as session:
        ...

def get_blockscout_transactions(self, address: str, ...):
    try:
        import requests  # âš ï¸ åŒæ­¥è¯·æ±‚æ··ç”¨
        ...
```
**é—®é¢˜**: 
- ä½¿ç”¨ `aiohttp` å¼‚æ­¥èŽ·å–ä»·æ ¼
- ä½¿ç”¨ `requests` åŒæ­¥èŽ·å–é“¾ä¸Šæ•°æ®
- åŒä¸€ä¸ªç±»ä¸­æ··ç”¨ä¸¤ç§HTTPå®¢æˆ·ç«¯
**å»ºè®®**: ç»Ÿä¸€ä½¿ç”¨ `aiohttp` æˆ–å¼•å…¥å¼‚æ­¥åŒ…è£…å™¨

### 5. å¼‚å¸¸å¤„ç†è¿‡äºŽå®½æ³›
**ä½ç½®**: å¤šä¸ªæ–‡ä»¶
```python
try:
    ...
except Exception as e:
    logger.error(f"å¤±è´¥: {e}")
    return None  # æˆ–é»˜è®¤ç©ºå€¼
```
**é—®é¢˜**: æ•èŽ·æ‰€æœ‰å¼‚å¸¸ï¼Œéšè—äº†çœŸæ­£çš„é”™è¯¯åŽŸå› ã€‚
**å»ºè®®**: 
- åŒºåˆ†å¯æ¢å¤é”™è¯¯å’Œä¸å¯æ¢å¤é”™è¯¯
- æ·»åŠ è¯¦ç»†çš„é”™è¯¯ä¸Šä¸‹æ–‡
- è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»åž‹

### 6. ç¼ºå°‘è¾“å…¥éªŒè¯
**ä½ç½®**: `commodity-monitor/src/factors/factor_pe.py`
```python
def calculate_score(self, pe: float) -> float:
    if pe is None or pe <= 0:
        return 0
    # ç¼ºå°‘å¯¹ NaNã€Inf çš„æ£€æŸ¥
```
**å»ºè®®**: ä½¿ç”¨ç±»åž‹æ³¨è§£å’Œè¿è¡Œæ—¶éªŒè¯ï¼ˆå¦‚ `pydantic`ï¼‰

---

## ðŸŸ¡ è½»å¾®é—®é¢˜

### 7. æ–‡æ¡£ç¼ºå¤±
- `monitor_base.py` ç¼ºå°‘æ¨¡å—çº§æ–‡æ¡£å­—ç¬¦ä¸²
- éƒ¨åˆ†å‡½æ•°ç¼ºå°‘å‚æ•°è¯´æ˜Ž
- ç¼ºå°‘ API é™æµè¯´æ˜Ž

### 8. å‘½åä¸ä¸€è‡´
- `ScoringSystem.calculate_score()` vs `FactorPE.calculate_score()` 
  - ç¬¬ä¸€ä¸ªè¿”å›žå­—å…¸ï¼Œç¬¬äºŒä¸ªè¿”å›žåˆ†æ•°
- æ—¶é—´æ ¼å¼æ··ç”¨ï¼š`datetime.now().isoformat()` vs `timestamp`

### 9. æµ‹è¯•è¦†ç›–ä¸è¶³
- ç¼ºå°‘å•å…ƒæµ‹è¯•æ–‡ä»¶
- `factors/` å’Œ `utils/` ç›®å½•ç¼ºå°‘ `__init__.py` æµ‹è¯•è¦†ç›–
- æ²¡æœ‰ CI/CD é…ç½®

---

## ðŸ“ æž¶æž„è¯„ä¼°

### ä¼˜ç‚¹
âœ… **æ¨¡å—åŒ–è®¾è®¡è‰¯å¥½**ï¼š
- `factors/` å› å­åŸºç±»è®¾è®¡åˆç†ï¼Œæ˜“äºŽæ‰©å±•
- `utils/` å·¥å…·å‡½æ•°èŒè´£å•ä¸€ï¼Œå¯å¤ç”¨
- é…ç½®ä¸Žä»£ç åˆ†ç¦»

âœ… **è®¾è®¡æ¨¡å¼åº”ç”¨**ï¼š
- åŸºç±» `BaseFactor` ä½¿ç”¨ ABC æŠ½è±¡æ¨¡æ¿æ–¹æ³•
- `DirectionMixin` æ··å…¥ç±»å¤ç”¨æ–¹å‘åˆ¤æ–­é€»è¾‘

### éœ€æ”¹è¿›
âš ï¸ **èŒè´£è¾¹ç•Œæ¨¡ç³Š**ï¼š
- `monitor_base.py` åŒ…å«4ä¸ªç›‘æŽ§ç±»å’Œä¸»ç±»ï¼Œå…±900è¡Œ+
- å»ºè®®æ‹†åˆ†ï¼šä»·æ ¼ã€å¤§æˆ·ã€èµ„é‡‘æµå‘ã€æ¸…ç®—å„ç‹¬ç«‹æ¨¡å—

âš ï¸ **ä¾èµ–ç®¡ç†**ï¼š
- åŒæ—¶ä¾èµ– `requests` å’Œ `aiohttp`
- å»ºè®®ç»Ÿä¸€ä½¿ç”¨ `aiohttp`

---

## ðŸ”§ æŠ€æœ¯å€ºåŠ¡æ¸…å•

| ä¼˜å…ˆçº§ | é—®é¢˜ | é¢„ä¼°å·¥æ—¶ |
|--------|------|----------|
| é«˜ | å®‰å…¨ï¼šä½¿ç”¨ç¤ºä¾‹åœ°å€æ›¿ä»£çœŸå®žåœ°å€ | 0.5h |
| é«˜ | å®‰å…¨ï¼šæ·»åŠ é…ç½®éªŒè¯æœºåˆ¶ | 1h |
| ä¸­ | æ€§èƒ½ï¼šç»Ÿä¸€ HTTP å®¢æˆ·ç«¯ | 2h |
| ä¸­ | è´¨é‡ï¼šæ·»åŠ è¾“å…¥éªŒè¯ | 1h |
| ä¸­ | è´¨é‡ï¼šæ·»åŠ è¯¦ç»†å¼‚å¸¸å¤„ç† | 2h |
| ä½Ž | æ–‡æ¡£ï¼šè¡¥å…… API æ–‡æ¡£ | 1h |
| ä½Ž | æµ‹è¯•ï¼šæ·»åŠ å•å…ƒæµ‹è¯• | 3h |

---

## âœ… æ”¹è¿›å»ºè®®

### çŸ­æœŸï¼ˆæœ¬å‘¨ï¼‰
1. **å®‰å…¨åŠ å›º**ï¼š
   - å°†çœŸå®žåœ°å€æ›¿æ¢ä¸ºç¤ºä¾‹å ä½ç¬¦
   - æ·»åŠ é…ç½®éªŒè¯è„šæœ¬
   - æ•æ„Ÿä¿¡æ¯ä½¿ç”¨çŽ¯å¢ƒå˜é‡

2. **ä»£ç è´¨é‡**ï¼š
   - ç»Ÿä¸€ HTTP å®¢æˆ·ç«¯åº“
   - æ·»åŠ è¯¦ç»†çš„å¼‚å¸¸æ—¥å¿—

### ä¸­æœŸï¼ˆæœ¬æœˆï¼‰
1. **æž¶æž„ä¼˜åŒ–**ï¼š
   - æ‹†åˆ† `monitor_base.py` ä¸ºç‹¬ç«‹æ¨¡å—
   - å¼•å…¥ `pydantic` è¿›è¡Œæ•°æ®éªŒè¯
   - å»ºç«‹ç»Ÿä¸€çš„é”™è¯¯ç ä½“ç³»

2. **å·¥ç¨‹å®žè·µ**ï¼š
   - é…ç½® GitHub Actions CI/CD
   - æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
   - å¼•å…¥ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼ˆblackã€ruffï¼‰

### é•¿æœŸï¼ˆå­£åº¦ï¼‰
1. **å¯è§‚æµ‹æ€§**ï¼š
   - é›†æˆ Prometheus æŒ‡æ ‡
   - æ·»åŠ é“¾è·¯è¿½è¸ª
   - å»ºç«‹ SLO/SLA ç›‘æŽ§

2. **å®¹ç¾èƒ½åŠ›**ï¼š
   - å®žçŽ°æ–­è·¯å™¨æ¨¡å¼
   - æ·»åŠ æœ¬åœ°ç¼“å­˜å±‚
   - å¤šæ•°æ®æºè‡ªåŠ¨åˆ‡æ¢

---

## ðŸ“Š æŒ‡æ ‡ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ€»ä»£ç è¡Œæ•° (Python) | ~2000 è¡Œ |
| æ ¸å¿ƒæ¨¡å—æ•° | 4 ä¸ª |
| å› å­æ¨¡å—æ•° | 11 ä¸ª |
| å·¥å…·æ¨¡å—æ•° | 6 ä¸ª |
| ä¸¥é‡é—®é¢˜ | 3 é¡¹ |
| ä¸­ç­‰é—®é¢˜ | 3 é¡¹ |
| è½»å¾®é—®é¢˜ | 3 é¡¹ |

---

## ðŸŽ¯ ç»“è®º

é¡¹ç›®æ•´ä½“æž¶æž„è®¾è®¡åˆç†ï¼Œæ¨¡å—åŒ–ç¨‹åº¦è¾ƒé«˜ã€‚ä¸»è¦æŠ€æœ¯å€ºåŠ¡é›†ä¸­åœ¨ï¼š
1. **å®‰å…¨æ€§**ï¼šæ•æ„Ÿä¿¡æ¯å¤„ç†éœ€è¦è§„èŒƒåŒ–
2. **ä¸€è‡´æ€§**ï¼šHTTPå®¢æˆ·ç«¯å’Œé”™è¯¯å¤„ç†éœ€è¦ç»Ÿä¸€
3. **å¯ç»´æŠ¤æ€§**ï¼šç¼ºå°‘æµ‹è¯•å’Œæ–‡æ¡£

å»ºè®®æŒ‰ç…§ä¸Šè¿°ä¼˜å…ˆçº§é€æ­¥æ”¹è¿›ï¼Œ**ä¼˜å…ˆè§£å†³å®‰å…¨ç›¸å…³é—®é¢˜**ã€‚

---

**å®¡æŸ¥å®Œæˆæ—¶é—´**: 2026-02-09 12:24 GMT+8
